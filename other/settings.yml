---
- hosts: all
  tasks:
    - name: Ensure local bin directory exists
      file:
        path: ~/.local/bin
        state: directory
        mode: '0755'

    - name: Install Downloads cleanup script
      copy:
        src: "{{ curdir }}/scripts/cleanup_downloads.sh"
        dest: ~/.local/bin/cleanup_downloads.sh
        mode: '0755'


    - name: Ensure cron package is installed (Debian)
      become: yes
      package:
        name: cron
        state: present
      when: ansible_facts['pkg_mgr'] == 'apt'

    - name: Ensure cron package is installed (Omarchy)
      become: yes
      package:
        name: cronie
        state: present
      when: ansible_facts['pkg_mgr'] == 'pacman'

    - name: Schedule daily Downloads cleanup
      cron:
        name: Cleanup Downloads files older than 30 days
        special_time: daily
        job: "$HOME/.local/bin/cleanup_downloads.sh >/dev/null 2>&1"

    - name: Configure GNOME settings
      when: ansible_facts['distribution'] == 'Ubuntu'
      block:
        - name: Set Terminal as favorite app
          command: gsettings set org.gnome.shell favorite-apps "['org.gnome.Terminal.desktop', 'piavpn.desktop', 'sidekick-browser.desktop', 'telegramdesktop.desktop', 'gnome-control-center.desktop']"

        - name: Set dark theme
          command: gsettings set org.gnome.desktop.interface color-scheme 'prefer-dark'

        - name: Set accent color as Purple
          command: gsettings set org.gnome.desktop.interface gtk-theme 'Yaru-purple'

        - name: Set dock fixed false
          command: gsettings set org.gnome.shell.extensions.dash-to-dock dock-fixed false

        - name: Enable dock autohide
          command: gsettings set org.gnome.shell.extensions.dash-to-dock autohide true

        - name: Set dock to Bottom
          command: gsettings set org.gnome.shell.extensions.dash-to-dock dock-position BOTTOM
